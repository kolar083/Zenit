<!DOCTYPE html>
<html lang="hr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mapa sportskih objekata + Vremenski Widget</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<style>
html, body { height: 100%; margin: 0; padding: 0; font-family: Arial, sans-serif; }

/* Mapa */
#map {
    position: absolute;
    top: 0;
    right: 0;
    width: 30%;
    height: 60vh;
    z-index: 1000;
}

/* Vremenski widget */
#weather-widget {
    position: absolute;
    top: 60vh;
    right: 0;
    width: 28%;
    height: 40vh;
    z-index: 1001;

    background: linear-gradient(to bottom, #4a90e2, #357ABD);
    color: white;
    padding: 15px 20px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    overflow: hidden;
    border-top-left-radius: 10px;
}

/* Glavni deo trenutnog vremena */
#current-weather {
    display: flex;
    flex-direction: row;
    align-items: center;
    width: 100%;
    margin-bottom: 10px;
}

#current-weather img {
    width: 60px;
    height: 60px;
    margin-right: 10px;
    animation: float 2s infinite;
}

#temperature { font-size: 2em; font-weight: bold; }
#description { text-transform: capitalize; font-size: 1em; margin: 2px 0; }
#location { font-weight: bold; font-size: 1.8em; }
#datetime {
    font-size: 0.9em;      /* možeš i veći, npr. 1.4em ili 1.5em po želji */
    font-weight: bold;
    margin-bottom: 10px;
    opacity: 0.9;
}

#minmax { font-size: 0.85em; margin-top: 3px; }

/* Forecast */
#forecast {
    margin-top: 30px;           /* spuštenije od trenutnog vremena */
    display: flex;
    justify-content: space-around; /* ravnomerni razmaci sa leve i desne ivice */
    width: 100%;
}

.day {
    text-align: center;
    font-size: 1em;             /* srednji font za dan i temperaturu */
}

.day img {
    width: 50px;                 /* ikonice srednje veličine */
    height: 50px;
    margin-bottom: 5px;
}

.day div {
    font-size: 0.95em;           /* tekst malo veći */
}

/* Animacija float */
@keyframes float { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }

/* Night mode */
.night { background: linear-gradient(to bottom, #1a1a2e, #2b2b44) !important; color: #f0f4f8 !important; }
body.night { background: #121224 !important; }

</style>
</head>
<body>

<div id="map"></div>

<div id="weather-widget">
    <div id="location">Učitavanje...</div>
    <div id="datetime"></div>
    <div id="current-weather">
        <img id="icon" src="" alt="Weather Icon">
        <div>
            <div id="temperature"></div>
            <div id="description"></div>
            <div id="minmax"></div>
        </div>
    </div>
    <div id="forecast"></div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
// --- Leaflet mapa ---
const map = L.map('map').setView([45.8,16.0],13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);

// --- Dohvat sportskih objekata ---
function fetchSportsData(lat, lon){
    const query = `[out:json];(node["sport"](around:30000,${lat},${lon});way["sport"](around:30000,${lat},${lon});relation["sport"](around:30000,${lat},${lon}););out center;`;
    const url = 'https://overpass-api.de/api/interpreter?data=' + encodeURIComponent(query);
    fetch(url)
        .then(res=>res.json())
        .then(data=>{
            data.elements.forEach(el=>{
                let coords;
                if(el.type==="node") coords=[el.lat,el.lon];
                else if(el.type==="way"||el.type==="relation") coords=[el.center.lat,el.center.lon];
                if(coords) L.marker(coords).addTo(map).bindPopup(el.tags.name||"Sportski objekt");
            });
        }).catch(err=>console.error(err));
}

// --- WeatherAPI.com ---
const weatherApiKey = '76c3274616114882a35174718261601'; // ubaci svoj ključ

function showWeather(data){
    const hours = new Date().getHours();
    if(hours<6||hours>18){
        document.body.classList.add('night');
        document.getElementById('weather-widget').classList.add('night');
    }

    const now = new Date(data.location.localtime);
    document.getElementById('location').innerText = data.location.name;
    document.getElementById('datetime').innerText = now.toLocaleString('sr-RS',{weekday:'short', day:'numeric', month:'short', hour:'2-digit', minute:'2-digit'});

    document.getElementById('temperature').innerText = Math.round(data.current.temp_c)+"°C";
    document.getElementById('description').innerText = data.current.condition.text;
    document.getElementById('icon').src = "https:"+data.current.condition.icon;

    document.getElementById('minmax').innerText = `Min: ${Math.round(data.forecast.forecastday[0].day.mintemp_c)}°C / Max: ${Math.round(data.forecast.forecastday[0].day.maxtemp_c)}°C`;

    // 3-dnevna prognoza
    const forecastDiv = document.getElementById('forecast');
    forecastDiv.innerHTML="";
    data.forecast.forecastday.forEach(day=>{
        const dayName = new Date(day.date).toLocaleDateString('sr-RS',{weekday:'short'});
        const icon = "https:" + day.day.condition.icon;
        const temp = Math.round(day.day.avgtemp_c)+"°C";
        forecastDiv.innerHTML+=`<div class="day">
            <div>${dayName}</div>
            <img src="${icon}">
            <div>${temp}</div>
        </div>`;
    });
}

// --- Fetch Weather po koordinatama ---
function fetchWeather(lat, lon){
    fetch(`https://api.weatherapi.com/v1/forecast.json?key=${weatherApiKey}&q=${lat.toFixed(6)},${lon.toFixed(6)}&days=3&aqi=no&alerts=no`)
        .then(res=>res.json())
        .then(showWeather)
        .catch(err=>console.error("Greška u vremenskom API:", err));
}

// --- Fetch Weather po gradu (fallback) ---
function fetchWeatherByCity(city){
    fetch(`https://api.weatherapi.com/v1/forecast.json?key=${weatherApiKey}&q=${city}&days=3&aqi=no&alerts=no`)
        .then(res=>res.json())
        .then(showWeather)
        .catch(err=>console.error("Greška u vremenskom API:", err));
}

// --- Geolokacija korisnika + mapa ---
function locateUser(){
    if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition(pos=>{
            const lat=pos.coords.latitude;
            const lon=pos.coords.longitude;

            L.marker([lat,lon]).addTo(map).bindPopup("<b>Tvoja lokacija</b>").openPopup();
            map.setView([lat,lon],12);
            L.circle([lat,lon],{color:'blue',fillColor:'#blue',fillOpacity:0.1,radius:30000}).addTo(map);

            fetchSportsData(lat,lon);
            fetchWeather(lat,lon);
        },()=> fetchWeatherByCity("Belgrade"));
    }else fetchWeatherByCity("Belgrade");
}

locateUser();
</script>

</body>
</html>
